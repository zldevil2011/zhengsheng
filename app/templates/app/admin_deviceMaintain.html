{% extends "app/base.html" %}
{% block title %}设备维修{% endblock %}
{% block main_body %}
    <div class="main-body">
{#        bread direction#}
        <div class="bg-color" style="margin: 10px 0;position: relative;padding: 10px 12px;">
            <span class="glyphicon glyphicon-home" style="display: inline-block;"></span>
            <ul class="breadcrumb breadcrumb-my" style="display: inline-block;">
				<li>
					 <a href="#">主页</a>
				</li>
				<li>
					 <a href="#">设备</a>
				</li>
				<li class="active">
					设备维修
				</li>
			</ul>
        </div>
{#        account list#}
        <div class="row bg-color" style="padding: 10px 30px;">
            {% include 'app/location_filter.html' %}
            <div class="form-group">
                <form class="form-horizontal" role="form" onsubmit="return false;">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="" class="col-sm-4 control-label">设备编号</label>
                            <div class="col-sm-8">
                                <input name = "device_id" type="text" class="form-control" id="" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="" class="col-sm-3 control-label">生产时间</label>
                            <div class="col-sm-4">
                                <input name = "start_time" type="date" class="form-control" id="" />
                            </div>
                            <label for="" class="col-sm-1 control-label">至</label>
                            <div class="col-sm-4">
                                <input name = "end_time" type="date" class="form-control" id="" />
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">关键字</label>
                            <div class="col-sm-6">
                                <input name = "key" type="text" class="form-control" id="" />
                            </div>
                            <div class="col-sm-4">
                                <button class="btn btn-block btn-success" name="filter_device">查找</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-md-12 column" style="">
                <table class="table device-list">
                    <thead>
                        <tr style="background-color: rgba(39,25,25,0.35);">
                            <th>
                                设备编号
                            </th>
                            <th>
                                设备类型
                            </th>
                            <th>
                                设备地址
                            </th>
                            <th>
                                设备状态
                            </th>
                            <th>
                                设备所有者
                            </th>
                            <th>
                                安装时间
                            </th>
                            <th>
                                操作
                            </th>
                        </tr>
                    </thead>
                    <tbody name="device_list_tr">
                    {% for repair in repair_list %}
                        <tr>
                            <td>{{ repair.device.device_id }}</td>
                            <td>{{ repair.type }}</td>
                            <td>{{ repair.address }}</td>
                            <td><span class="btn btn-danger">{{ repair.device.device_status }}</span></td>
                            <td>{{ repair.user }}</td>
                            <td>{{ repair.time }}</td>
                            <td><button class="btn btn-warning">维修记录</button></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <div class="col-md-12 column" style="text-align: right;">
                    <ul class="pagination account-pagination" style="">
                        <li>
                             <a href="/admin_device/maintain?page={{ page|add:-1 }}">上一页</a>
                        </li>
                        <li>
                             <a href="#"><span name="page">{{ page }}</span> / <span name="total_page">{{ total_page }}</span></a>
                        </li>
                        <li>
                             <a href="/admin_device/maintain?page={{ page|add:1 }}">下一页</a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-12">
                    <div class="col-md-2">
                        <h4><b>维修记录</b></h4>
                    </div><div class="col-md-10"></div>
                    <div class="col-md-12">
                        <hr>
                    </div>
                    <div class="col-md-12">
                        <form class="" role="form" onsubmit="return false;">
                            <div class="col-md-4">
                                <div class="form-group col-md-4" style="height: 30px; line-height: 30px;">
                                    设备编号
                                </div>
                                <div class="form-group col-md-8" style="height: 30px; ">
                                    <input type="text" class="form-control" id="" placeholder="IMGXXXXXX"/>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group col-md-4" style="height: 30px; line-height: 30px;">
                                    设备名称
                                </div>
                                <div class="form-group col-md-8" style="height: 30px; ">
                                    <input type="text" class="form-control" id=""  placeholder="设备名称"/>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group col-md-4" style="height: 30px; line-height: 30px;">
                                    送修时间
                                </div>
                                <div class="form-group col-md-8" style="height: 30px; ">
                                    <input type="text" class="form-control" id=""  placeholder="2016-xx-xx"/>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group col-md-4" style="height: 30px; line-height: 30px;">
                                    送修用户
                                </div>
                                <div class="form-group col-md-8" style="height: 30px; ">
                                    <input type="text" class="form-control" id=""  placeholder="张三"/>
                                </div>
                            </div>
                            <div class="col-md-8"></div>
                            <div class="col-md-12">
                                <div class="form-group col9-md-1" style="height: 30px; line-height: 30px;">
                                    维修状态
                                </div>
                                <div class="form-group col9-md-8 maintain-process" style="height: 30px;">
                                    <div class="col-md-2">
                                        <span class="active">-------></span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="active">开始送修</span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="active">-------></span>
                                    </div>
                                    <div class="col-md-2">
                                        <span class="active">正在维修</span>
                                    </div>
                                    <div class="col-md-2">
                                        <span>-------></span>
                                    </div>
                                    <div class="col-md-2">
                                        <span>维修成功</span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}
{% block special_js %}
    <script>
        $("[name=filter_device]").on("click", function(){
            var device_id =  $("[name=device_id]").val();
            var start_time = $("[name=start_time]").val();
            var end_time = $("[name=end_time]").val();
            console.log(start_time);;
            console.log(end_time);
            var key = $("[name=key]").val();
            $.ajax({
                url: '/admin_device/filter/',
                type: 'POST',
                data: {device_id:device_id, start_time:start_time, end_time: end_time, key:key, status:2},
                success: function(data){
                    if(data == "error"){
                        alert("查找失败");
                    }else{
{#                        console.log(data);#}
                        var innerHtml = "";
                        for(var i = 0; i < data.length; ++i){
                            var device = data[i];
                            innerHtml += '<tr><td>' + device.device_id + '</td>' +
                                '<td>' + device.type + '</td><td>' + device.address + '</td>' +
                                '<td><span class="btn btn-danger">' + device.device_status + '<span></td><td>' + device.user + '</td>' +
                                '<td>' + device.manufacture_date + '</td><td><button class="btn btn-warning">维修记录</button></td></tr>';
                        }
                        $("[name=device_list_tr]").html(innerHtml);
                    }
                },
                error: function(data){
                    alert("服务器错误");
                }
            })
        });
    </script>
{% endblock %}